---
title: "Summary statistics"
output: md_document
params:
    stats_list: NA
    dist_select: NA
    country_select: NA
always_allow_html: yes

---

```{r load_packages, echo = FALSE}

require(kableExtra)
require(knitr)
require(RColorBrewer)
require(plotfunctions)

country_select <- params$country_select
dist_select <- params$dist_select

dist_names <- unique(dist_select$NAME)

```

## AppName Output Report
#### This document contains summary statistics for `r country_select$name`, and the following selected districts: `r dist_names`. 

#### Summary statistics for each selected variable appear below, and were generated using the "zonal" function within the "raster" R package.

</br>

```{r pop_stat_1, results = "axis", echo = FALSE}
knitr::opts_chunk$set(echo = TRUE)

stats_list <- params$stats_list

dist_select <- params$dist_select

# subset to get specified table
table_one <- stats_list[[1]]

# get variable names
variable_n <- names(table_one)[2]
variable_n <- substr(variable_n, 1, nchar(variable_n)-7)

names(table_one) <- c("District",
                      "Mean",
                      "Max",
                      "Min",
                      "Standard Deviation")

# round so that values aren't ridiculously long
table_one$Mean <- round(table_one$Mean, 2)
table_one$Max <- round(table_one$Max, 2)
table_one$Min <- round(table_one$Min, 2)
table_one$`Standard Deviation` <- round(table_one$`Standard Deviation`, 2)

x <- kable(table_one,
           row.names = FALSE,
           caption = variable_n,
           align = "c")

column_spec(x, 1:5, width = "10em")

```

</br>

```{r pop_stats_2, results = "axis", echo = FALSE}
if(length(stats_list) > 1){

# subset to get specified table
table_two <- stats_list[[2]]

# get variable names
variable_n2 <- names(table_two)[2]
variable_n2 <- substr(variable_n2, 1, nchar(variable_n2)-7)

names(table_two) <- c("District",
                      "Mean",
                      "Max",
                      "Min",
                      "Standard Deviation")

# round so that values aren't ridiculously long
table_two$Mean <- round(table_two$Mean, 2)
table_two$Max <- round(table_two$Max, 2)
table_two$Min <- round(table_two$Min, 2)
table_two$`Standard Deviation` <- round(table_two$`Standard Deviation`, 2)

y <- kable(table_two,
           row.names = FALSE,
           caption = variable_n2,
           align = "c")

column_spec(y, 1:5, width = "10em")

}

```

</br>

```{r pop_stats_3, results = "axis", echo = FALSE}
if(length(stats_list) > 2){

# subset to get specified table
table_three <- stats_list[[3]]

# get variable names
variable_n3 <- names(table_three)[2]
variable_n3 <- substr(variable_n3, 1, nchar(variable_n3)-7)

names(table_three) <- c("District",
                      "Mean",
                      "Max",
                      "Min",
                      "Standard Deviation")

# round so that values aren't ridiculously long
table_three$Mean <- round(table_three$Mean, 2)
table_three$Max <- round(table_three$Max, 2)
table_three$Min <- round(table_three$Min, 2)
table_three$`Standard Deviation` <- round(table_three$`Standard Deviation`, 2)

z <- kable(table_three,
           row.names = FALSE,
           caption = variable_n3,
           align = "c")

column_spec(z, 1:5, width = "10em")
  
}
```

</br>

```{r pop_stats_4, results = "axis", echo = FALSE}
if(length(stats_list) > 3){

# subset to get specified table
table_four <- stats_list[[4]]

# get variable names
variable_n4 <- names(table_four)[2]
variable_n4 <- substr(variable_n4, 1, nchar(variable_n4)-7)

names(table_four) <- c("District",
                      "Mean",
                      "Max",
                      "Min",
                      "Standard Deviation")

# round so that values aren't ridiculously long
table_four$Mean <- round(table_four$Mean, 2)
table_four$Max <- round(table_four$Max, 2)
table_four$Min <- round(table_four$Min, 2)
table_four$`Standard Deviation` <- round(table_four$`Standard Deviation`, 2)

aa <- kable(table_four,
            row.names = FALSE,
            caption = variable_n4,
            align = "c")

column_spec(aa, 1:5, width = "10em")

}
```

</br>

```{r stat_plots, echo = FALSE, results = "hide", fig.height = 10, fig.width = 10}
# generate shapefile for the plot
if(length(stats_list) == 1){
  
  # first create an index
  dist_index <- which(dist_select$NAME == table_one$District)
  dist_select_v1 <- dist_select
  dist_select_v1$mean <- table_one$Mean[dist_index]
  
  # create a bespoke palette
  colour_p_v1 <- colorRampPalette(brewer.pal(brewer.pal.info["YlGnBu",1], "YlGnBu"))(length(dist_select$mean))
  dist_select_v1$colours <- colour_p_v1[as.numeric(cut(dist_select_v1$mean, breaks = (length(dist_select_v1$mean))))]

  country_select <- params$country_select

  print(plot(country_select,
             axes = FALSE,
             col = "#d9d9d9")) 

  print(plot(dist_select_v1,
             add = TRUE,
             col = dist_select_v1$colours,
             lty = 3))

  title(variable_n, 
        cex.main = 1, col.main = "#18c8cf",
        adj = 0)
  
  gradientLegend(valRange = c(min(dist_select_v1$mean), max(dist_select_v1$mean)), 
                 color = colour_p_v1, 
                 nCol = length(dist_select_v1$mean), 
                 pos = 0.5, 
                 side = 4,
                 length = 0.25, 
                 depth = 0.05, 
                 inside = TRUE, 
                 coords = FALSE,
                 pos.num = NULL, 
                 n.seg = 3, 
                 border.col = "black", 
                 dec = 2,
                 fit.margin = TRUE)
  
  }

if(length(stats_list) == 2){
  
  dist_index <- which(dist_select$NAME == table_one$District)
  
  dist_select_v1 <- dist_select
  dist_select_v2 <- dist_select
  dist_select_v1$mean <- table_one$Mean[dist_index]
  dist_select_v2$mean <- table_two$Mean[dist_index]
  
  # create a bespoke palette
  colour_p_v1 <- colorRampPalette(brewer.pal(brewer.pal.info["YlGnBu",1], "YlGnBu"))(length(dist_select_v1$mean))
  colour_p_v2 <- colorRampPalette(brewer.pal(brewer.pal.info["YlGnBu",1], "YlGnBu"))(length(dist_select_v2$mean))
  dist_select_v1$colours <- colour_p_v1[as.numeric(cut(dist_select_v1$mean, breaks = (length(dist_select_v1$mean))))]
  dist_select_v2$colours <- colour_p_v2[as.numeric(cut(dist_select_v2$mean, breaks = (length(dist_select_v2$mean))))]
  
  # define plotting parameters
  par(mfrow = c(1,2))
  
  country_select <- params$country_select

  # plot first stat
  print(plot(country_select,
             axes = FALSE,
             col = "#d9d9d9")) 

  print(plot(dist_select_v1,
             add = TRUE,
             col = dist_select_v1$colours,
             lty = 3))

  title(variable_n, 
        cex.main = 1, col.main = "#18c8cf",
        adj = 0)
  
  gradientLegend(valRange = c(min(dist_select_v1$mean), max(dist_select_v1$mean)), 
                 color = colour_p_v1, 
                 nCol = length(dist_select_v1$mean), 
                 pos = 0.5, 
                 side = 4,
                 length = 0.25, 
                 depth = 0.05, 
                 inside = TRUE, 
                 coords = FALSE,
                 pos.num = NULL, 
                 n.seg = 3, 
                 border.col = "black", 
                 dec = 2,
                 fit.margin = TRUE)
  
  # plot second stat
  print(plot(country_select,
             axes = FALSE,
             col = "#d9d9d9")) 

  print(plot(dist_select_v2,
             add = TRUE,
             col = dist_select_v2$colours,
             lty = 3))

  title(variable_n2, 
        cex.main = 1, col.main = "#18c8cf",
        adj = 0)
  
  gradientLegend(valRange = c(min(dist_select_v2$mean), max(dist_select_v2$mean)), 
                 color = colour_p_v2, 
                 nCol = length(dist_select_v2$mean), 
                 pos = 0.5, 
                 side = 4,
                 length = 0.25, 
                 depth = 0.05, 
                 inside = TRUE, 
                 coords = FALSE,
                 pos.num = NULL, 
                 n.seg = 3, 
                 border.col = "black", 
                 dec = 2,
                 fit.margin = TRUE)
  
}

if(length(stats_list) == 3){
  
  dist_index <- which(dist_select$NAME == table_one$District)
  
  dist_select_v1 <- dist_select
  dist_select_v2 <- dist_select
  dist_select_v3 <- dist_select
  dist_select_v1$mean <- table_one$Mean[dist_index]
  dist_select_v2$mean <- table_two$Mean[dist_index]
  dist_select_v3$mean <- table_three$Mean[dist_index]
  
  # create a bespoke palette
  colour_p_v1 <- colorRampPalette(brewer.pal(brewer.pal.info["YlGnBu",1], "YlGnBu"))(length(dist_select_v1$mean))
  colour_p_v2 <- colorRampPalette(brewer.pal(brewer.pal.info["YlGnBu",1], "YlGnBu"))(length(dist_select_v2$mean))
  colour_p_v3 <- colorRampPalette(brewer.pal(brewer.pal.info["YlGnBu",1], "YlGnBu"))(length(dist_select_v3$mean))
  dist_select_v1$colours <- colour_p_v1[as.numeric(cut(dist_select_v1$mean, breaks = (length(dist_select_v1$mean))))]
  dist_select_v2$colours <- colour_p_v2[as.numeric(cut(dist_select_v2$mean, breaks = (length(dist_select_v2$mean))))]
  dist_select_v3$colours <- colour_p_v3[as.numeric(cut(dist_select_v3$mean, breaks = (length(dist_select_v3$mean))))]
  
  # define plotting parameters
  par(mfrow = c(2,2))
  
  country_select <- params$country_select

  # plot first stat
  print(plot(country_select,
             axes = FALSE,
             col = "#d9d9d9")) 

  print(plot(dist_select_v1,
             add = TRUE,
             col = dist_select_v1$colours,
             lty = 3))

  title(variable_n, 
        cex.main = 1, col.main = "#18c8cf",
        adj = 0)
  
  gradientLegend(valRange = c(min(dist_select_v1$mean), max(dist_select_v1$mean)), 
                 color = colour_p_v1, 
                 nCol = length(dist_select_v1$mean), 
                 pos = 0.5, 
                 side = 4,
                 length = 0.25, 
                 depth = 0.05, 
                 inside = TRUE, 
                 coords = FALSE,
                 pos.num = NULL, 
                 n.seg = 3, 
                 border.col = "black", 
                 dec = 2,
                 fit.margin = TRUE)

  # plot second stat
  print(plot(country_select,
             axes = FALSE,
             col = "#d9d9d9")) 

  print(plot(dist_select_v2,
             add = TRUE,
             col = dist_select_v2$colours,
             lty = 3))

  title(variable_n2, 
        cex.main = 1, col.main = "#18c8cf",
        adj = 0)
  
  gradientLegend(valRange = c(min(dist_select_v2$mean), max(dist_select_v2$mean)), 
                 color = colour_p_v2, 
                 nCol = length(dist_select_v2$mean), 
                 pos = 0.5, 
                 side = 4,
                 length = 0.25, 
                 depth = 0.05, 
                 inside = TRUE, 
                 coords = FALSE,
                 pos.num = NULL, 
                 n.seg = 3, 
                 border.col = "black", 
                 dec = 2,
                 fit.margin = TRUE)
  
  # plot third stat
  print(plot(country_select,
             axes = FALSE,
             col = "#d9d9d9")) 
  
  print(plot(dist_select_v3,
             add = TRUE,
             col = dist_select_v3$colours,
             lty = 3))

  title(variable_n3, 
        cex.main = 1, col.main = "#18c8cf",
        adj = 0)
  
  gradientLegend(valRange = c(min(dist_select_v3$mean), max(dist_select_v3$mean)), 
                 color = colour_p_v3, 
                 nCol = length(dist_select_v3$mean), 
                 pos = 0.5, 
                 side = 4,
                 length = 0.25, 
                 depth = 0.05, 
                 inside = TRUE, 
                 coords = FALSE,
                 pos.num = NULL, 
                 n.seg = 3, 
                 border.col = "black", 
                 dec = 2,
                 fit.margin = TRUE)
  
  }

if(length(stats_list) == 4){
  
  dist_index <- which(dist_select$NAME == table_one$District)
  
  dist_select_v1 <- dist_select
  dist_select_v2 <- dist_select
  dist_select_v3 <- dist_select
  dist_select_v4 <- dist_select
  dist_select_v1$mean <- table_one$Mean[dist_index]
  dist_select_v2$mean <- table_two$Mean[dist_index]
  dist_select_v3$mean <- table_three$Mean[dist_index]
  dist_select_v4$mean <- table_four$Mean[dist_index]
  
  # create a bespoke palette
  colour_p_v1 <- colorRampPalette(brewer.pal(brewer.pal.info["YlGnBu",1], "YlGnBu"))(length(dist_select_v1$mean))
  colour_p_v2 <- colorRampPalette(brewer.pal(brewer.pal.info["YlGnBu",1], "YlGnBu"))(length(dist_select_v2$mean))
  colour_p_v3 <- colorRampPalette(brewer.pal(brewer.pal.info["YlGnBu",1], "YlGnBu"))(length(dist_select_v3$mean))
  colour_p_v4 <- colorRampPalette(brewer.pal(brewer.pal.info["YlGnBu",1], "YlGnBu"))(length(dist_select_v4$mean))
  dist_select_v1$colours <- colour_p_v1[as.numeric(cut(dist_select_v1$mean, breaks = (length(dist_select_v1$mean))))]
  dist_select_v2$colours <- colour_p_v2[as.numeric(cut(dist_select_v2$mean, breaks = (length(dist_select_v2$mean))))]
  dist_select_v3$colours <- colour_p_v3[as.numeric(cut(dist_select_v3$mean, breaks = (length(dist_select_v3$mean))))]
  dist_select_v4$colours <- colour_p_v4[as.numeric(cut(dist_select_v4$mean, breaks = (length(dist_select_v4$mean))))]
  
  # define plotting parameters
  par(mfrow = c(2,2))
  
  country_select <- params$country_select

  # plot first stat
  print(plot(country_select,
             axes = FALSE,
             col = "#d9d9d9")) 

  print(plot(dist_select_v1,
             add = TRUE,
             col = dist_select_v1$colours,
             lty = 3))

  title(variable_n, 
        cex.main = 1, col.main = "#18c8cf",
        adj = 0)
  
  gradientLegend(valRange = c(min(dist_select_v1$mean), max(dist_select_v1$mean)), 
                 color = colour_p_v1, 
                 nCol = length(dist_select_v1$mean), 
                 pos = 0.5, 
                 side = 4,
                 length = 0.25, 
                 depth = 0.05, 
                 inside = TRUE, 
                 coords = FALSE,
                 pos.num = NULL, 
                 n.seg = 3, 
                 border.col = "black", 
                 dec = 2,
                 fit.margin = TRUE)

  # plot second stat
  print(plot(country_select,
             axes = FALSE,
             col = "#d9d9d9")) 

  print(plot(dist_select_v2,
             add = TRUE,
             col = dist_select_v2$colours,
             lty = 3))

  title(variable_n2, 
        cex.main = 1, col.main = "#18c8cf",
        adj = 0)
  
  gradientLegend(valRange = c(min(dist_select_v2$mean), max(dist_select_v2$mean)), 
                 color = colour_p_v2, 
                 nCol = length(dist_select_v2$mean), 
                 pos = 0.5, 
                 side = 4,
                 length = 0.25, 
                 depth = 0.05, 
                 inside = TRUE, 
                 coords = FALSE,
                 pos.num = NULL, 
                 n.seg = 3, 
                 border.col = "black", 
                 dec = 2,
                 fit.margin = TRUE)
  
  # plot third stat
  print(plot(country_select,
             axes = FALSE,
             col = "#d9d9d9")) 
  
  print(plot(dist_select_v3,
             add = TRUE,
             col = dist_select_v3$colours,
             lty = 3))

  title(variable_n3, 
        cex.main = 1, col.main = "#18c8cf",
        adj = 0)
  
  gradientLegend(valRange = c(min(dist_select_v3$mean), max(dist_select_v3$mean)), 
                 color = colour_p_v3, 
                 nCol = length(dist_select_v3$mean), 
                 pos = 0.5, 
                 side = 4,
                 length = 0.25, 
                 depth = 0.05, 
                 inside = TRUE, 
                 coords = FALSE,
                 pos.num = NULL, 
                 n.seg = 3, 
                 border.col = "black", 
                 dec = 2,
                 fit.margin = TRUE)
  
  # plot fourth stat
  print(plot(country_select,
             axes = FALSE,
             col = "#d9d9d9")) 
  
  print(plot(dist_select_v4,
             add = TRUE,
             col = dist_select_v4$colours,
             lty = 3))

  title(variable_n4, 
        cex.main = 1, col.main = "#18c8cf",
        adj = 0)
  
  gradientLegend(valRange = c(min(dist_select_v4$mean), max(dist_select_v4$mean)), 
                 color = colour_p_v4, 
                 nCol = length(dist_select_v4$mean), 
                 pos = 0.5, 
                 side = 4,
                 length = 0.25, 
                 depth = 0.05, 
                 inside = TRUE, 
                 coords = FALSE,
                 pos.num = NULL, 
                 n.seg = 3, 
                 border.col = "black", 
                 dec = 2,
                 fit.margin = TRUE)
  
  }

```
